<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Activities – Nandan Kumar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* PAGE LAYOUT (matches your gallery style) */
    .activities-page{
      max-width: 1200px;
      margin: 0 auto;
      padding: 2.2rem 1.4rem 3.4rem;
    }

    .page-header{
      text-align:center;
      margin-bottom: 18px;
    }
    .page-header h1{
      font-size: 2.15rem;
      margin-bottom: .45rem;
      letter-spacing: .03em;
    }
    .page-header p{
      max-width: 900px;
      margin: .25rem auto 0;
      color:#6b7280;
      font-size: .98rem;
      line-height: 1.65;
    }

    /* FILTER CHIPS */
    .chip-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin: 14px 0 18px;
    }
    .chip{
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.7);
      color: #0f172a;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: .85rem;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .chip:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(15,23,42,.10); }
    .chip.active{
      background: rgba(59,130,246,.10);
      border-color: rgba(59,130,246,.35);
    }

    /* ====== SERVICE / REVIEW SECTION ====== */
    .service-wrap{
      max-width: 1200px;
      margin: 0 auto 20px;
    }
    .service-card{
      border-radius: 16px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(15,23,42,.10);
      padding: 16px;
    }
    .service-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .service-head h2{
      margin:0;
      color:#0f172a;
      font-size: 1.12rem;
      letter-spacing:.01em;
    }
    .service-head p{
      margin: 6px 0 0;
      color:#475569;
      font-size:.95rem;
      line-height:1.55;
    }
    .service-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(59,130,246,.10);
      border: 1px solid rgba(59,130,246,.22);
      color:#0f172a;
      font-weight: 700;
      font-size: .86rem;
      white-space: nowrap;
    }

    .journal-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 14px;
    }
    @media (max-width: 980px){
      .journal-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 700px){
      .journal-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .journal-tile{
      border-radius: 14px;
      overflow:hidden;
      background: #0f172a;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
      display:flex;
      flex-direction:column;
      min-height: 220px;
    }
    .journal-img{
      height: 120px;
      background: #111827;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position: relative;
    }
    .journal-img img{
      width: 100%;
      height: 100%;
      object-fit: contain;     /* show full “cover/hero” */
      display:block;
    }
    .journal-body{
      padding: 12px 12px 12px;
      color:#f9fafb;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex: 1 1 auto;
    }
    .journal-title{
      margin:0;
      font-size: .95rem;
      font-weight: 700;
      line-height: 1.3;
    }
    .journal-meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color: rgba(229,231,235,.9);
      font-size: .82rem;
      margin-top:auto;
    }
    .journal-badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(59,130,246,.16);
      border: 1px solid rgba(59,130,246,.22);
      color: #e5edff;
      font-weight: 700;
      font-size: .78rem;
    }
    .journal-link{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color:#e5e7eb;
      font-size: .86rem;
      text-decoration:none;
      width: fit-content;
    }
    .journal-link:hover{
      background: rgba(255,255,255,.12);
    }

    /* ====== MAIN GRID ====== */
    .activity-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 20px;
    }
    @media (max-width: 1000px){
      .activity-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .activity-grid{ grid-template-columns: 1fr; }
    }

    .activity-card{
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      background: #0f172a;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
      display:flex;
      flex-direction:column;
      min-height: 330px;
    }

    /* OPTION A: SHOW FULL CLIP (NO CROPPING) */
    .img-wrap{
      position: relative;
      height: 260px;
      background: #111827;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .img-wrap img{
      width: 100%;
      height: 100%;
      object-fit: contain;  /* ✅ full image */
      display:block;
      transform: scale(1);
      transition: transform .25s ease;
    }
    .activity-card:hover .img-wrap img{
      transform: scale(1.01);
    }

    .badge-row{
      position:absolute;
      top: 12px;
      left: 12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      z-index: 2;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: .78rem;
      font-weight: 600;
      color: #e5e7eb;
      background: rgba(15,23,42,.65);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
    }

    .zoom-hint{
      position:absolute;
      right: 12px;
      top: 12px;
      z-index:2;
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#e5e7eb;
      background: rgba(15,23,42,.55);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
      cursor:pointer;
    }

    .card-body{
      padding: 14px 14px 14px;
      color:#f9fafb;
      display:flex;
      flex-direction:column;
      gap:10px;
      flex: 1 1 auto;
    }
    .card-title{
      font-size: 1.02rem;
      font-weight: 700;
      line-height: 1.35;
      margin: 0;
    }
    .card-desc{
      margin: 0;
      font-size: .92rem;
      line-height: 1.55;
      color: rgba(249,250,251,.86);
    }

    .meta-row{
      margin-top:auto;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      color: rgba(229,231,235,.9);
      font-size: .82rem;
    }
    .meta-left, .meta-right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .meta-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(59,130,246,.16);
      border: 1px solid rgba(59,130,246,.22);
      color: #e5edff;
      font-weight: 600;
      font-size: .78rem;
    }

    .links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 2px;
    }
    .link-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color:#e5e7eb;
      font-size: .86rem;
      text-decoration:none;
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
    }
    .link-btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.12);
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
    }

    /* MODAL */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.75);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 9999;
    }
    .modal.open{ display:flex; }
    .modal-inner{
      max-width: min(1100px, 96vw);
      max-height: 92vh;
      background: rgba(15,23,42,.92);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      display:flex;
      flex-direction:column;
    }
    .modal-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding: 12px 12px;
      color:#e5e7eb;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modal-top strong{ font-size: .95rem; font-weight: 700; }
    .modal-close{
      cursor:pointer;
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color:#e5e7eb;
    }
    .modal-img-wrap{
      background: #0b1220;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px;
    }
    .modal-img-wrap img{
      max-width: 100%;
      max-height: 78vh;
      object-fit: contain;
      display:block;
      border-radius: 12px;
      background: #0b1220;
    }

    .muted-note{
      text-align:center;
      margin-top: 14px;
      color:#6b7280;
      font-size: .9rem;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="site-title">
        <a href="index.html">NANDAN KUMAR</a>
      </div>
      <nav class="nav-links">
        <a class="nav-link" href="index.html">Home</a>
        <a class="nav-link" href="publications.html">Publications</a>
        <a class="nav-link" href="research.html">Research</a>
        <a class="nav-link" href="conferences.html">Conferences</a>
        <a class="nav-link active" href="activities.html">Activities</a>
        <a class="nav-link" href="gallery.html">Gallery</a>
        <a class="nav-link" href="contact.html">Contact</a>
      </nav>
    </div>
  </div>

  <main class="activities-page">
    <header class="page-header">
      <h1>Activities</h1>
      <p>
        Selected highlights from academic milestones, outreach, and professional activities,
        including verified media coverage and professional service.
      </p>

      <div class="chip-row" id="chipRow">
        <div class="chip active" data-filter="all">All</div>
        <div class="chip" data-filter="news">News</div>
        <div class="chip" data-filter="award">Awards</div>
        <div class="chip" data-filter="training">Training</div>
        <div class="chip" data-filter="outreach">Outreach</div>
        <div class="chip" data-filter="service">Peer Review</div>
      </div>
    </header>

    <!-- ✅ REVIEW SECTION -->
    <section class="service-wrap" id="serviceSection">
      <div class="service-card">
        <div class="service-head">
          <div>
            <h2>Peer Review Service (2022–Present)</h2>
            <p>
              Reviewer for <strong>30+ manuscripts</strong> across journals in food science,
              biomolecular research, and computational biology.
            </p>
          </div>
          <div class="service-pill">
            <i class="fa-solid fa-shield-halved"></i> 30+ Reviews
          </div>
        </div>
        <div class="journal-grid" id="journalGrid"></div>
      </div>
    </section>

    <section class="activity-grid" id="grid"></section>

    <p class="muted-note">
      Tip: Click any clip to view it in full (no cropping).
    </p>

    <div class="footer">
      <span>© 2025 Nandan Kumar.</span>
      <span class="footer-sep">·</span>
      <span>Visits (this browser): <span id="visitor-count">—</span></span>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal" aria-hidden="true">
      <div class="modal-inner" role="dialog" aria-modal="true">
        <div class="modal-top">
          <strong id="modalTitle">Preview</strong>
          <div class="modal-close" id="modalClose" title="Close">
            <i class="fa-solid fa-xmark"></i>
          </div>
        </div>
        <div class="modal-img-wrap">
          <img id="modalImg" src="" alt="Full preview">
        </div>
      </div>
    </div>

    <!-- Visitor counter -->
    <script>
      (function () {
        const el = document.getElementById('visitor-count');
        if (!el) return;
        const key = 'nk_site_visit_count';
        let count = parseInt(localStorage.getItem(key) || '0', 10);
        count += 1;
        localStorage.setItem(key, String(count));
        el.textContent = count.toLocaleString();
      })();
    </script>

    <!-- DATA + RENDER -->
    <script>
      /**
       * ✅ Cover image resolver:
       * For any item with `articleUrl`, we fetch og:image/twitter:image and use it as the image.
       * Uses https://r.jina.ai proxy to avoid browser CORS blocks.
       */
      const OG_CACHE_KEY = "nk_ogimg_cache_v1";

      function getCache(){
        try { return JSON.parse(localStorage.getItem(OG_CACHE_KEY) || "{}"); }
        catch(e){ return {}; }
      }
      function setCache(cache){
        try { localStorage.setItem(OG_CACHE_KEY, JSON.stringify(cache)); } catch(e){}
      }

      async function resolveOGImage(articleUrl){
        if (!articleUrl) return null;

        const cache = getCache();
        if (cache[articleUrl] && cache[articleUrl].value !== undefined){
          return cache[articleUrl].value; // can be null
        }

        try{
          const proxied = "https://r.jina.ai/http://" + articleUrl.replace(/^https?:\/\//, "");
          const res = await fetch(proxied);
          if (!res.ok) throw new Error("proxy fetch failed");
          const html = await res.text();

          const og1 = html.match(/property=["']og:image["'][^>]*content=["']([^"']+)["']/i);
          const og2 = html.match(/name=["']twitter:image["'][^>]*content=["']([^"']+)["']/i);
          const og3 = html.match(/property=["']twitter:image["'][^>]*content=["']([^"']+)["']/i);

          const img = (og1 && og1[1]) || (og2 && og2[1]) || (og3 && og3[1]) || null;

          cache[articleUrl] = { value: img, t: Date.now() };
          setCache(cache);
          return img;
        }catch(e){
          const cache2 = getCache();
          cache2[articleUrl] = { value: null, t: Date.now() };
          setCache(cache2);
          return null;
        }
      }

      function fallbackLogoFromUrl(articleUrl){
        try{
          const domain = new URL(articleUrl).hostname.replace(/^www\./, "");
          return "https://logo.clearbit.com/" + domain;
        }catch(e){
          return "https://logo.clearbit.com/example.com";
        }
      }

      function escapeHtml(str){
        return String(str || "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      /* ========= YOUR NEWS/ACTIVITY ITEMS ========= */
      const items = [
        /* === PRINT CLIPS (YOUR PNGs) === */
        {
          id: "prabhat-convocation-2018",
          tags: ["news","award"],
          badge: "News · Award",
          title: "CUSB Convocation & Gold Medals (Prabhat Khabar)",
          desc:
            "Hindi daily Prabhat Khabar covered the CUSB convocation and gold medal awards, including my recognition among the gold medal recipients.",
          date: "26 Mar 2018",
          place: "Gaya / South Bihar",
          sourceLabel: "Prabhat Khabar",
          img: "prabhat-khabar-cusb-2018.png",
          links: []
        },
        {
          id: "prabhat-convocation-collage",
          tags: ["news","award"],
          badge: "News · Award",
          title: "Convocation Highlights (Prabhat Khabar – Clip)",
          desc:
            "Additional clip from the same coverage highlighting the convocation ceremony and gold medal announcements.",
          date: "2018",
          place: "Bihar, India",
          sourceLabel: "Prabhat Khabar",
          img: "parbhat_goldmedal.png",
          links: []
        },
        {
          id: "genome-training-hindi",
          tags: ["news","training"],
          badge: "News · Training",
          title: "Genome Analysis Training Program (Hindi Press)",
          desc:
            "Hindi media reported on a genome analysis training program conducted by the Department of Bioinformatics, CUSB, where I served as one of the student trainers, assisting in hands-on instruction on computational genome analysis and bioinformatics workflows.",
          date: "—",
          place: "CUSB, India",
          sourceLabel: "Hindi Press",
          img: "genome-training.png",
          links: []
        },

        /* CSIR–JIGYASA (your scanned/clip PNGs) */
        {
          id: "csir-jigyasa-morung-scan",
          tags: ["news","outreach"],
          badge: "News · Outreach",
          title: "CSIR–JIGYASA Outreach (Print Clip)",
          desc:
            "Media coverage of CSIR–JIGYASA outreach at Livingstone Foundation International (LFI), where we visited the school as part of a CSIR outreach team, aimed at promoting scientific temper and engagement among school students in Northeast India.",
          date: "Mar 2022",
          place: "Dimapur, Nagaland",
          sourceLabel: "Print coverage (scan)",
          img: "csir_jigyasa_clip_1.png",
          links: [
            { label: "Read online (Morung Express)", url: "https://morungexpress.com/lfi-collaborates-withcsir-jigyasa-program" }
          ]
        },

        /* === ONLINE ARTICLES (AUTO COVER IMAGE) === */
        {
          id: "toi-convocation-2018",
          tags: ["news","award"],
          badge: "Online · Award",
          title: "CUSB Convocation Coverage (Times of India)",
          desc:
            "The Times of India reported on the CUSB convocation ceremony, during which gold medals were awarded to academic toppers, including me, alongside degree awards to graduating students.",
          date: "2018",
          place: "Patna, India",
          sourceLabel: "Times of India",
          articleUrl: "https://timesofindia.indiatimes.com/city/patna/cusb-convocation-675-receive-degrees/articleshow/63493024.cms",
          img: "", /* keep empty -> auto cover */
          links: [
            { label: "Read article", url: "https://timesofindia.indiatimes.com/city/patna/cusb-convocation-675-receive-degrees/articleshow/63493024.cms" }
          ]
        },
        {
          id: "hans-nobel-outreach",
          tags: ["news","outreach"],
          badge: "Online · Outreach",
          title: "Nobel Laureate Outreach Highlight (The Hans India)",
          desc:
            "The Hans India covered an outreach event featuring Nobel Laureate Prof. Kurt Wüthrich, highlighting student interaction and science inspiration activities.",
          date: "2017",
          place: "India",
          sourceLabel: "The Hans India",
          articleUrl: "https://www.thehansindia.com/posts/index/Hyderabad-Tab/2017-02-08/Nobel-laureate-inspires-children/279347",
          img: "https://www.thehansindia.com/images/logo1.png?v=2",
          links: [
            { label: "Read article", url: "https://www.thehansindia.com/posts/index/Hyderabad-Tab/2017-02-08/Nobel-laureate-inspires-children/279347" }
          ]
        }
      ];

      /* ========= PEER REVIEW JOURNALS (AUTO COVER IMAGE) =========
         Each tile tries og:image from the journal page. If blocked -> logo fallback.
      */
      const reviewJournals = [
        { name: "International Journal of Biological Macromolecules", count: 7, url: "https://www.sciencedirect.com/journal/international-journal-of-biological-macromolecules" },
        { name: "Food Research International", count: 2, url: "https://www.sciencedirect.com/journal/food-research-international" },
        { name: "Journal of Food Science", count: 8, url: "https://ift.onlinelibrary.wiley.com/journal/17503841" },
        { name: "Frontiers in Microbiology", count: 1, url: "https://www.frontiersin.org/journals/microbiology" },
        { name: "Frontiers in Genetics (Computational Genomics)", count: 1, url: "https://www.frontiersin.org/journals/genetics" },
        { name: "Frontiers in Molecular Biosciences (Biophysics)", count: 1, url: "https://www.frontiersin.org/journals/molecular-biosciences" },
        { name: "Frontiers in Sustainable Food Systems (Nutrition & Sustainable Diets)", count: 1, url: "https://www.frontiersin.org/journals/sustainable-food-systems" },
        { name: "Frontiers in Pharmacology (Translational Pharmacology)", count: 1, url: "https://www.frontiersin.org/journals/pharmacology" }
      ];

      const grid = document.getElementById("grid");
      const journalGrid = document.getElementById("journalGrid");
      const serviceSection = document.getElementById("serviceSection");

      function iconFor(tags){
        if (tags.includes("award")) return "fa-award";
        if (tags.includes("training")) return "fa-laptop-code";
        if (tags.includes("outreach")) return "fa-people-group";
        return "fa-newspaper";
      }

      async function getItemImage(item){
        // If user provided image (PNG or fixed URL), use it
        if (item.img && item.img.trim() !== "") return item.img;

        // Else try OG cover from articleUrl
        if (item.articleUrl){
          const og = await resolveOGImage(item.articleUrl);
          if (og) return og;
          return fallbackLogoFromUrl(item.articleUrl);
        }

        return "https://logo.clearbit.com/example.com";
      }

      async function render(filter="all"){
        // show/hide service section by filter
        if (filter === "service"){
          serviceSection.style.display = "block";
          grid.innerHTML = "";
          return;
        } else {
          serviceSection.style.display = "block"; // keep visible on All and other filters (you can set to "none" if you prefer)
        }

        grid.innerHTML = "";
        const data = (filter === "all")
          ? items
          : items.filter(x => x.tags.includes(filter));

        for (const item of data){
          const card = document.createElement("article");
          card.className = "activity-card";
          card.dataset.tags = item.tags.join(",");

          const imgSrc = await getItemImage(item);

          const linksHtml = (item.links && item.links.length)
            ? `<div class="links">
                 ${item.links.map(l => `
                   <a class="link-btn" href="${l.url}" target="_blank" rel="noopener">
                     <i class="fa-solid fa-arrow-up-right-from-square"></i> ${escapeHtml(l.label)}
                   </a>
                 `).join("")}
               </div>`
            : "";

          card.innerHTML = `
            <div class="img-wrap" data-full="${escapeHtml(imgSrc)}" data-title="${escapeHtml(item.title)}" role="button" tabindex="0" aria-label="Open full preview">
              <div class="badge-row">
                <span class="badge"><i class="fa-solid ${iconFor(item.tags)}"></i> ${escapeHtml(item.badge)}</span>
              </div>
              <div class="zoom-hint" title="View full">
                <i class="fa-solid fa-magnifying-glass-plus"></i>
              </div>
              <img src="${escapeHtml(imgSrc)}" alt="${escapeHtml(item.title)}" loading="lazy" referrerpolicy="no-referrer">
            </div>

            <div class="card-body">
              <h3 class="card-title">${escapeHtml(item.title)}</h3>
              <p class="card-desc">${escapeHtml(item.desc)}</p>

              ${linksHtml}

              <div class="meta-row">
                <div class="meta-left">
                  <span class="meta-pill"><i class="fa-regular fa-calendar"></i> ${escapeHtml(item.date || "—")}</span>
                  <span class="meta-pill"><i class="fa-regular fa-newspaper"></i> ${escapeHtml(item.sourceLabel || "—")}</span>
                </div>
                <div class="meta-right">
                  <span style="opacity:.9;"><i class="fa-solid fa-location-dot"></i> ${escapeHtml(item.place || "—")}</span>
                </div>
              </div>
            </div>
          `;

          grid.appendChild(card);
        }

        bindPreviewHandlers();
      }

      /* ====== Render journal tiles with auto “cover image” ====== */
      async function renderJournals(){
        if (!journalGrid) return;
        journalGrid.innerHTML = "";

        for (const j of reviewJournals){
          const tile = document.createElement("div");
          tile.className = "journal-tile";

          // Try og:image from journal page; fallback to logo
          let img = await resolveOGImage(j.url);
          if (!img) img = fallbackLogoFromUrl(j.url);

          tile.innerHTML = `
            <div class="journal-img">
              <img src="${escapeHtml(img)}" alt="${escapeHtml(j.name)} cover" loading="lazy" referrerpolicy="no-referrer">
            </div>
            <div class="journal-body">
              <p class="journal-title">${escapeHtml(j.name)}</p>
              <a class="journal-link" href="${escapeHtml(j.url)}" target="_blank" rel="noopener">
                <i class="fa-solid fa-arrow-up-right-from-square"></i> Journal page
              </a>
              <div class="journal-meta">
                <span class="journal-badge"><i class="fa-solid fa-hashtag"></i> ${j.count}</span>
                <span style="opacity:.92;"><i class="fa-regular fa-calendar"></i> 2022–Present</span>
              </div>
            </div>
          `;

          journalGrid.appendChild(tile);
        }
      }

      /* MODAL PREVIEW */
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modalImg");
      const modalTitle = document.getElementById("modalTitle");
      const modalClose = document.getElementById("modalClose");

      function openModal(src, title){
        modalTitle.textContent = title || "Preview";
        modalImg.src = src;
        modal.classList.add("open");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }
      function closeModal(){
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden", "true");
        modalImg.src = "";
        document.body.style.overflow = "";
      }

      function bindPreviewHandlers(){
        document.querySelectorAll(".img-wrap").forEach(wrap => {
          const open = () => openModal(wrap.dataset.full, wrap.dataset.title);
          wrap.addEventListener("click", open);
          wrap.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") open();
          });
        });
      }

      modalClose.addEventListener("click", closeModal);
      modal.addEventListener("click", (e) => {
        if (e.target === modal) closeModal();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modal.classList.contains("open")) closeModal();
      });

      /* FILTER CHIPS */
      const chips = document.querySelectorAll(".chip");
      chips.forEach(chip => {
        chip.addEventListener("click", async () => {
          chips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          await render(chip.dataset.filter);
        });
      });

      /* Initial render */
      (async function init(){
        await renderJournals();
        await render("all");
      })();
    </script>
  </main>
</body>
</html>
